# ============================================================================
# Конфигурация Supervisor
# Управляет Gunicorn и Nginx процессами в контейнере
# ============================================================================

[supervisord]
# Запуск на переднем плане (для Docker)
nodaemon=true
# Путь к лог-файлу
logfile=/var/log/supervisor/supervisord.log
# Путь к pid-файлу
pidfile=/run/supervisord.pid
# Уровень логирования
loglevel=info

# ============================================================================
# Gunicorn - WSGI сервер для Django
# ============================================================================
[program:gunicorn]
# Команда запуска Gunicorn
command=gunicorn web_dashboard.wsgi:application --bind 127.0.0.1:8000 --workers 2 --threads 4 --worker-class gthread --timeout 120 --access-logfile - --error-logfile -
# Рабочая директория
directory=/app
# Пользователь для запуска
user=appuser
# Автоматический запуск
autostart=true
# Автоматический перезапуск при падении
autorestart=true
# Перенаправление stdout
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
# Перенаправление stderr
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
# Переменные окружения
environment=DJANGO_SETTINGS_MODULE="web_dashboard.settings_prod"

# ============================================================================
# Nginx - веб-сервер и обратный прокси
# ============================================================================
[program:nginx]
# Команда запуска Nginx
command=nginx
# Автоматический запуск
autostart=true
# Автоматический перезапуск при падении
autorestart=true
# Перенаправление stdout
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
# Перенаправление stderr
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
